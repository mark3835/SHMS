<div>
	<h4>職業安全衛生訓練證照登錄</h4>
</div>
<div>
	<table style="border-collapse: collapse; width: 100%;" border="1">
		<tbody>
			<tr>
				<td style="width: 20%;">單位名稱</td>
				<td style="width: 28.6162%;">&nbsp;</td>
				<td style="width: 22.2193%;">作業人員</td>
				<td style="width: 9.16449%;">總務</td>
				<td style="width: 20%;">&nbsp;</td>
			</tr>
		</tbody>
	</table>
	<br>
	<table style="border-collapse: collapse; width: 100%; height: 126px;"
		border="1">
		<tbody>
			<tr style="height: 18px;">
				<td style="width: 15.9922%; height: 18px;">姓名</td>
				<td style="width: 34.0078%; height: 18px;">&nbsp;</td>
				<td style="width: 17.5587%; height: 18px;">職稱</td>
				<td style="width: 32.4413%; height: 18px;">&nbsp;</td>
			</tr>
			<tr style="height: 18px;">
				<td style="width: 15.9922%; height: 18px;">手機(選項)</td>
				<td style="width: 34.0078%; height: 18px;">&nbsp;</td>
				<td style="width: 17.5587%; height: 18px;">email</td>
				<td style="width: 32.4413%; height: 18px;">&nbsp;</td>
			</tr>
			<tr style="height: 18px;">
				<td style="width: 15.9922%; height: 18px;">證書種類</td>
				<td style="width: 34.0078%; height: 18px;">&nbsp;</td>
				<td style="width: 17.5587%; height: 18px;">證書字號</td>
				<td style="width: 32.4413%; height: 18px;">&nbsp;</td>
			</tr>
			<tr style="height: 18px;">
				<td style="width: 15.9922%; height: 18px;">核發單位</td>
				<td style="width: 34.0078%; height: 18px;">&nbsp;</td>
				<td style="width: 17.5587%; height: 18px;">取得日期</td>
				<td style="width: 32.4413%; height: 18px;">&nbsp;</td>
			</tr>
			<tr style="height: 18px;">
				<td style="width: 15.9922%; height: 18px;">報名費用</td>
				<td style="width: 34.0078%; height: 18px;">&nbsp;</td>
				<td style="width: 17.5587%; height: 18px;">派訓單位</td>
				<td style="width: 32.4413%; height: 18px;">&nbsp;</td>
			</tr>
			<tr style="height: 18px;">
				<td style="width: 15.9922%; height: 18px;">審核人員</td>
				<td style="width: 34.0078%; height: 18px;">&nbsp;</td>
				<td style="width: 17.5587%; height: 18px;">備註(退休)</td>
				<td style="width: 32.4413%; height: 18px;">&nbsp;</td>
			</tr>
			<tr style="height: 18px;">
				<td style="width: 15.9922%; height: 18px;" colspan="2">該員(所持本證照)為擔任本項業務負責人</td>
				<td style="width: 17.5587%; height: 18px;" colspan="2">單位三項業務各一人負責</td>
			</tr>
		</tbody>
	</table>
	<br>
	<div style="text-align: center;">
		<button type="submit" id="saveBtn">儲存</button>
	</div>
	<br>
	<div id="printDiv">
		<table style="border-collapse: collapse; width: 100%; height: 108px;" border="1">
		  <thead>
		    <tr style="height: 18px;">
		      <td style="width: 28.1332%; height: 18px;">業務負責人職稱</td>
		      <td style="width: 14.295%; height: 18px;">姓名</td>
		      <td style="width: 22.389%; height: 18px;">手機</td>
		      <td style="width: 35.1828%; height: 18px;">EMAIL</td>
		    </tr>
		  </thead>
		  <tbody id="tbody">
		  	<tr>
		  		<td>單位主管</td>
		  		<td></td>
		  		<td></td>
		  		<td></td>
		  	</tr>
		  	<tr>
		  		<td>職業安全衛生主管</td>
		  		<td></td>
		  		<td></td>
		  		<td></td>
		  	</tr>
		  	<tr>
		  		<td>總務</td>
		  		<td></td>
		  		<td></td>
		  		<td></td>
		  	</tr>
		  	<tr>
		  		<td>防火管理員</td>
		  		<td></td>
		  		<td></td>
		  		<td></td>
		  	</tr>
		  	<tr>
		  		<td>急救人員</td>
		  		<td></td>
		  		<td></td>
		  		<td></td>
		  	</tr>
		  </tbody>
		</table>
	</div>
	<br>
	<div style="text-align: center;">
		<button type="submit" id="printBtn">列印</button>
		<button type="submit" id="backBtn">回首頁</button>
	</div>
	<br>
	<div>
</div>


<script>
	//需要用的JS
	require([ "jquery", "jquery_validate", "jsgrid", "jquery_ui" ], function(
			jquery, jquery_validate, jsgrid, jquery_ui) {
		//頁面讀取後執行
		$(document).ready(function() {
			
			createSelect();
			
			$.ajax({
 			    url: "/"+CONFIG.SYSTEM_NAME + '/unitData/api/getUnitByUser',
 			   	contentType: "application/json;charset=utf-8", // 因為上面是JSON數據
 			    async: false,
 			    type: "GET",
 			    success: function(data, textStatus){   
 			    	 if(data && data == "<script>alert('沒有權限')<\/script>"){
			    		 alert("沒有權限");
			    	 }else{
			    		 console.log(data);
			    		 setData(data);
			    	 }
 			    },
 			    error: function (data, textStatus, errorThrown) {
 			        console.log(data);
 			    },
 			});
			
			$("#saveBtn").click(function(){
				saveData();
			});
			$("#printBtn").click(function(){
				printByDiv(document.getElementById("printDiv"));
			});
			$("#backBtn").click(function(){
				window.location.reload();
			});
		});
	});
	
	function createSelect(){
		$.ajax({
			    url: "/"+CONFIG.SYSTEM_NAME + '/unitData/api/getUnitUserList',
			   	contentType: "application/json;charset=utf-8", // 因為上面是JSON數據
			    async: false,
			    type: "GET",
			    success: function(data, textStatus){   
			    	 if(data && data == "<script>alert('沒有權限')<\/script>"){
		    		 alert("沒有權限");
		    	 }else{		    		 
		    		 $.each(data, function( index, item ) {
	    				$('#affairs').append($('<option>').val(item.rocId).text(item.name));
	    			});
		    	 }
			    },
			    error: function (data, textStatus, errorThrown) {
			        console.log(data);
			    },
			});
	}
	
	
	function getFormData($form){
	    var unindexed_array = $form.serializeArray();
	    var indexed_array = {};

	    $.map(unindexed_array, function(n, i){
	        indexed_array[n['name']] = n['value'];
	    });

	    return indexed_array;
	}
	
	function printByDiv(printpage){ 
		var iframe = document.createElement('IFRAME');
		iframe.setAttribute('style', 'position:absolute;width:0px;height:0px;left:-500px;top:-500px;');
		document.body.appendChild(iframe);
		iframe.contentWindow.document.write(printpage.innerHTML);
		iframe.contentWindow.document.close(); //important!
		iframe.contentWindow.focus(); //IE fix
		iframe.contentWindow.print();
		iframe.parentNode.removeChild(iframe);
	} 
</script>